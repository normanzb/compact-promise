!function(a,b){"function"==typeof define&&define.amd?define([],function(){return a.returnExportsGlobal=b()}):"object"==typeof exports?module.exports=b():a.Defer=b()}(this,function(){var a={f:function(a){return"function"==typeof a}},b=function(a){function b(a,b,c,d,e){return function(f){a[b]=f,e.value++,d.value===e.value&&c(a)}}return function(c){c.all=function(d){return new c.Promise(function(c,e){for(var f={value:d.length},g={value:0},h=[],i=d.length;i--;)d[i]&&a.f(d[i].then)?d[i].then(b(h,i,c,f,g),e):(h[i]=d[i],f.value--);return f.value<=0||f.value===g.value?void c(h):void 0})}}}(a),c=function(){var a=Function,b=new a("return this")(),c=!1,d=[];return function(a){d.push(a),c||(c=!0,(b.process&&b.process.nextTick||b.setImmediate||b.setTimeout)(function(){var a=d;d=[],c=!1;for(var b=0;b<a.length;b++)a[b]();a.length=0}))}}(),d=function(a,b,c){function d(a,b,c){var d;try{d=a.call(void 0,b)}catch(e){f(e),c.reject(e)}return d}function e(){this.promise._s=[],this.promise._f=[],this.promise._d=[]}function f(a){b.f(k.onError)&&k.onError(a)}function g(a){function b(a){i.result=a,i[n]=!0,i[p]=!1,c(function(){for(var a=0;a<i._s.length;a++)d(i._s[a],i.result,i._d[a]);e.call(g)})}function f(a){j(f,function(a){i[p]=!1,h.call(g,a)},b,g,a)}var g=this,i=g.promise;i[n]||i[o]||i[p]||(i[p]=!0,f(a))}function h(a){function b(a){i.error=a,i[o]=!0,i[p]=!1,c(function(){for(var a=0;a<i._f.length;a++)d(i._f[a],i.error,i._d[a]);e.call(h)})}function f(a){j(function(a){i[p]=!1,g.call(h,a)},f,b,h,a)}var h=this,i=h.promise;i[n]||i[o]||i[p]||(i[p]=!0,f(a))}function i(a,b){return function(e){c(function(){var c=d(a,e,b);j(b.resolve,b.reject,b.resolve,b,c)})}}function j(a,c,d,e,g){var h,i;try{h=("object"==typeof g||b.f(g))&&g&&g.then}catch(j){return f(j),void c.apply(e,[j])}if(g===e.promise)c.apply(e,[new TypeError(1)]);else if(b.f(h))try{h.call(g,function(b){i||(i=!0,a.call(e,b))},function(a){i||(i=!0,c.call(e,a))})}catch(j){if(i)return;i=!0,f(j),c.call(e,j)}else d.apply(e,void 0===g?[]:[g])}function k(a){if(!(this instanceof k))return new k(a);var c=this;c.promise=a&&b.f(a.then)?a:new l(c),c.resolve=function(a){g.call(c,a)},c.reject=function(a){h.call(c,a)}}function l(a){if(!(this instanceof l))return new l(a);if(this._s=[],this._f=[],this._d=[],this._defer=a&&a instanceof k?a:new k(this),this[n]=!1,this[o]=!1,this[p]=!1,this.result=null,this.error=null,b.f(a))try{a.call(this,this._defer.resolve,this._defer.reject)}catch(c){f(c),this._defer.reject(c)}}var m="prototype",n="resolved",o="rejected",p="pending";return l[m].then=function(a,c){var d,e,f=new k,g=this;return g._d.push(f),g[o]||(d=b.f(a)?i.call(g,a,f):f.resolve,g[n]?d.call(null,g.result):g._s.push(d)),g[n]||(e=b.f(c)?i.call(g,c,f):f.reject,g[o]?e.call(null,g.error):g._f.push(e)),f.promise},k.Promise=l,k.resolve=function(a){var b=new k;return b.resolve(a),b.promise},k.reject=function(a){var b=new k;return b.reject(a),b.promise},a(k),k}(b,a,c);return d});