!function(a,b){"function"==typeof define&&define.amd?define([],function(){return a.returnExportsGlobal=b()}):"object"==typeof exports?module.exports=b():a.Defer=b()}(this,function(){var a=function(){"use strict";function a(){var a=this;if(a.promise.result=arguments[0],!a.promise[i]){a.promise[h]=!0;for(var b=0;b<a.promise._s.length;b++)a.promise._s[b].call(null,a.promise.result);a.promise._s=[]}}function b(){var a=this;if(a.promise.error=arguments[0],!a.promise[h]){a.promise[i]=!0;for(var b=0;b<a.promise._f.length;b++)a.promise._f[b].call(null,a.promise.error);a.promise._f=[]}}function c(e){if(!(this instanceof c))return new c(e);var f=this;f.promise=e&&"then"in e?e:new d(f),f.resolve=function(){return a.apply(f,arguments)},f.reject=function(){return b.apply(f,arguments)}}function d(a){if(this._s=[],this._f=[],this._defer=a&&a instanceof c?a:new c(this),this.result=null,this.error=null,typeof a===g)try{a.call(this,this._defer.resolve,this._defer.reject)}catch(b){this._defer.reject(b)}}function e(a,b){var c=this;return function(){var d=a.apply(c,arguments);d&&typeof d.then===g?d.then(function(){b.resolve.apply(b,arguments)},function(){b.reject.apply(b,arguments)}):b.resolve.apply(b,null==d?[]:[d])}}var f="prototype",g="function",h="resolved",i="rejected";return d[f].then=function(a,b){var d,f,j=new c,k=this;return d=typeof a==g?e.call(k,a,j):j.resolve,k[h]?d.call(null,k.result):k._s.push(d),f=typeof b==g?e.call(k,b,j):j.reject,k[i]?f.call(null,k.error):k._f.push(f),j.promise},c.Promise=d,c.resolve=function(a){var b=new c;return b.resolve(a),b.promise},c.reject=function(a){var b=new c;return b.reject(a),b.promise},c.all=function(a){return new d(function(b,c){function d(a){g.push(a),f++,e===f&&b(g)}for(var e=a.length,f=0,g=[],h=a.length;h--;)"then"in a[h]?a[h].then(d,c):e--;return 0>=e?void b():void 0})},c}();return a});