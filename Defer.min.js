!function(a,b){"function"==typeof define&&define.amd?define([],function(){return a.returnExportsGlobal=b()}):"object"==typeof exports?module.exports=b():a.Defer=b()}(this,function(){var a=function(){"use strict";function a(){var a=this;if(a.promise.result=a.promise.result||arguments[0],!a.promise[j]&&!a.promise[k]){a.promise[j]=!0;for(var b=0;b<a.promise._s.length;b++)a.promise._s[b].call(null,a.promise.result);a.promise._s=[]}}function b(){var a=this;if(a.promise.error=a.promise.error||arguments[0],!a.promise[j]&&!a.promise[k]){a.promise[k]=!0;for(var b=0;b<a.promise._f.length;b++)a.promise._f[b].call(null,a.promise.error);a.promise._f=[]}}function c(e){if(!(this instanceof c))return new c(e);var g=this;g.promise=e&&"then"in e?e:new d(g),g.resolve=function(c){f(a,b,a,g,c)},g.reject=function(c){f(a,b,b,g,c)}}function d(a){if(!(this instanceof d))return new d(a);if(this._s=[],this._f=[],this._defer=a&&a instanceof c?a:new c(this),this.result=null,this.error=null,typeof a===i)try{a.call(this,this._defer.resolve,this._defer.reject)}catch(b){this._defer.reject(b)}}function e(a,b){var c=this;return function(){var d=a.apply(c,arguments);f(b.resolve,b.reject,b.resolve,b,d)}}function f(a,b,c,d,e){e&&typeof e.then===i?e.then(function(){a.apply(d,arguments)},function(){b.apply(d,arguments)}):c.apply(d,null==e?[]:[e])}function g(a,b,c,d,e){return function(f){a[b]=f,e.value++,d.value===e.value&&c(a)}}var h="prototype",i="function",j="resolved",k="rejected";return d[h].then=function(a,b){var d,f,g=new c,h=this;return d=typeof a==i?e.call(h,a,g):g.resolve,h[j]?d.call(null,h.result):h._s.push(d),f=typeof b==i?e.call(h,b,g):g.reject,h[k]?f.call(null,h.error):h._f.push(f),g.promise},c.Promise=d,c.resolve=function(a){var b=new c;return b.resolve(a),b.promise},c.reject=function(a){var b=new c;return b.reject(a),b.promise},c.all=function(a){return new d(function(b,c){for(var d={value:a.length},e={value:0},f=[],h=a.length;h--;)a[h]&&"then"in a[h]?a[h].then(g(f,h,b,d,e),c):(f[h]=a[h],d.value--);return d.value<=0||d.value===e.value?void b(f):void 0})},c}();return a});