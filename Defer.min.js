!function(a,b){"function"==typeof define&&define.amd?define([],function(){return a.returnExportsGlobal=b()}):"object"==typeof exports?module.exports=b():a.Defer=b()}(this,function(){var a=function(){"use strict";function a(){var a=this;if(a.promise.result=arguments[0],!a.promise[h]){a.promise[g]=!0;for(var b=0;b<a.promise._s.length;b++)a.promise._s[b].call(null,a.promise.result);a.promise._s=[]}}function b(){var a=this;if(a.promise.error=arguments[0],!a.promise[g]){a.promise[h]=!0;for(var b=0;b<a.promise._f.length;b++)a.promise._f[b].call(null,a.promise.error);a.promise._f=[]}}function c(e){if(!(this instanceof c))return new c(e);var f=this;f.promise=e&&"then"in e?e:new d(f),f.resolve=function(){return a.apply(f,arguments)},f.reject=function(){return b.apply(f,arguments)}}function d(a){if(this._s=[],this._f=[],this._defer=a&&a instanceof c?a:new c(this),this.result=null,this.error=null,typeof a===f)try{a.call(this,this._defer.resolve,this._defer.reject)}catch(b){this._defer.reject(b)}}var e="prototype",f="function",g="resolved",h="rejected";return d[e].then=function(a,b){var d=new c,e=this;if(typeof a==f){var i=function(){var b=a.apply(e,arguments);b&&typeof b.then===f?b.then(function(){d.resolve.apply(d,arguments)}):d.resolve.apply(d,null==b?[]:[b])};e[g]?i.call(null,e.result):e._s.push(i)}if(typeof b==f){var j=function(){var a=b.apply(e,arguments);a&&typeof a.then===f?a.then(function(){d.resolve.apply(d,arguments)}):d.resolve.apply(d,null==a?[]:[a])};e[h]?j.call(null,e.error):e._f.push(j)}return d.promise},c.Promise=d,c.resolve=function(){var a=new c;return a.resolve(),a.promise},c.all=function(a){return new d(function(b,c){function d(a){g.push(a),f++,e===f&&b(g)}for(var e=a.length,f=0,g=[],h=a.length;h--;)"then"in a[h]?a[h].then(d,c):e--;return 0>=e?void b():void 0})},c}();return a});