!function(a,b){"function"==typeof define&&define.amd?define([],function(){return a.returnExportsGlobal=b()}):"object"==typeof exports?module.exports=b():a.Defer=b()}(this,function(){var a=function(){"use strict";function a(){var a=this;if(a.promise.result=arguments[0],!a.promise[i]&&!a.promise[j]){a.promise[i]=!0;for(var b=0;b<a.promise._s.length;b++)a.promise._s[b].call(null,a.promise.result);a.promise._s=[]}}function b(){var a=this;if(a.promise.error=arguments[0],!a.promise[i]&&!a.promise[j]){a.promise[j]=!0;for(var b=0;b<a.promise._f.length;b++)a.promise._f[b].call(null,a.promise.error);a.promise._f=[]}}function c(e){if(!(this instanceof c))return new c(e);var f=this;f.promise=e&&"then"in e?e:new d(f),f.resolve=function(){return a.apply(f,arguments)},f.reject=function(){return b.apply(f,arguments)}}function d(a){if(this._s=[],this._f=[],this._defer=a&&a instanceof c?a:new c(this),this.result=null,this.error=null,typeof a===h)try{a.call(this,this._defer.resolve,this._defer.reject)}catch(b){this._defer.reject(b)}}function e(a,b){var c=this;return function(){var d=a.apply(c,arguments);d&&typeof d.then===h?d.then(function(){b.resolve.apply(b,arguments)},function(){b.reject.apply(b,arguments)}):b.resolve.apply(b,null==d?[]:[d])}}function f(a,b,c,d,e){return function(f){a[b]=f,e.value++,d.value===e.value&&c(a)}}var g="prototype",h="function",i="resolved",j="rejected";return d[g].then=function(a,b){var d,f,g=new c,k=this;return d=typeof a==h?e.call(k,a,g):g.resolve,k[i]?d.call(null,k.result):k._s.push(d),f=typeof b==h?e.call(k,b,g):g.reject,k[j]?f.call(null,k.error):k._f.push(f),g.promise},c.Promise=d,c.resolve=function(a){var b=new c;return b.resolve(a),b.promise},c.reject=function(a){var b=new c;return b.reject(a),b.promise},c.all=function(a){return new d(function(b,c){for(var d={value:a.length},e={value:0},g=[],h=a.length;h--;)"then"in a[h]?a[h].then(f(g,h,b,d,e),c):(g[h]=a[h],d.value--);return d.value<=0||d.value===e.value?void b([]):void 0})},c}();return a});