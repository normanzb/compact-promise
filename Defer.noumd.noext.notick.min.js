var util={f:function(a){return"function"==typeof a}},extAll=function(a){return function(){}}(util),tickSmall=function(a){a()},Defer=function(a,b,c){function d(a,c,d){var e;try{e=a.call(void 0,c)}catch(f){b.f(h.onError)&&h.onError(f),d.reject(f)}return e}function e(){this.promise._s=[],this.promise._f=[],this.promise._d=[]}function f(a){function b(a){i.result=a,i[m]=!0,i[o]=!1,c(function(){for(var a=0;a<i._s.length;a++)d(i._s[a],i.result,i._d[a]);e.call(h)})}function f(a){k(f,function(a){i[o]=!1,g.call(h,a)},b,h,a)}var h=this,i=h.promise;i[m]||i[n]||i[o]||(i[o]=!0,f(a))}function g(a){function b(a){i.error=a,i[n]=!0,i[o]=!1,c(function(){for(var a=0;a<i._f.length;a++)d(i._f[a],i.error,i._d[a]);e.call(h)})}function g(a){k(function(a){i[o]=!1,f.call(h,a)},g,b,h,a)}var h=this,i=h.promise;i[m]||i[n]||i[o]||(i[o]=!0,g(a))}function h(a){if(!(this instanceof h))return new h(a);var c=this;c.promise=a&&b.f(a.then)?a:new i(c),c.resolve=function(a){f.call(c,a)},c.reject=function(a){g.call(c,a)}}function i(a){if(!(this instanceof i))return new i(a);if(this._s=[],this._f=[],this._d=[],this._defer=a&&a instanceof h?a:new h(this),this[m]=!1,this[n]=!1,this[o]=!1,this.result=null,this.error=null,b.f(a))try{a.call(this,this._defer.resolve,this._defer.reject)}catch(c){this._defer.reject(c)}}function j(a,b){return function(e){c(function(){var c=d(a,e,b);k(b.resolve,b.reject,b.resolve,b,c)})}}function k(a,c,d,e,f){var g,i;try{g=("object"==typeof f||b.f(f))&&f&&f.then}catch(j){return void c.apply(e,[j])}if(f===e.promise)c.apply(e,[new TypeError(1)]);else if(b.f(g))try{g.call(f,function(b){i||(i=!0,a.call(e,b))},function(a){i||(i=!0,c.call(e,a))})}catch(j){if(i)return;i=!0,b.f(h.onError)&&h.onError(j),c.call(e,j)}else d.apply(e,void 0===f?[]:[f])}var l="prototype",m="resolved",n="rejected",o="pending";return i[l].then=function(a,c){var d,e,f=new h,g=this;return g._d.push(f),g[n]||(d=b.f(a)?j.call(g,a,f):f.resolve,g[m]?d.call(null,g.result):g._s.push(d)),g[m]||(e=b.f(c)?j.call(g,c,f):f.reject,g[n]?e.call(null,g.error):g._f.push(e)),f.promise},h.Promise=i,h.resolve=function(a){var b=new h;return b.resolve(a),b.promise},h.reject=function(a){var b=new h;return b.reject(a),b.promise},a(h),h}(extAll,util,tickSmall);