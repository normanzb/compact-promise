!function(a,b){"function"==typeof define&&define.amd?define([],function(){return a.returnExportsGlobal=b()}):"object"==typeof exports?module.exports=b():a.Defer=b()}(this,function(){return function(){var a;a={f:function(a){return"function"==typeof a}}}(),function(){var a;a=function(a){function b(a,b,c,d,e){return function(f){a[b]=f,e.value++,d.value===e.value&&c(a)}}return function(c){c.all=function(d){return new c.Promise(function(c,e){for(var f={value:d.length},g={value:0},h=[],i=d.length;i--;)d[i]&&a.f(d[i].then)?d[i].then(b(h,i,c,f,g),e):(h[i]=d[i],f.value--);if(f.value<=0||f.value===g.value)return void c(h)})}}}(util)}(),function(){var a;a=function(a){a()}}(),function(){var a;a=function(a,b,c){function d(a,b,c){var d;try{d=a[u](m,b)}catch(a){f(a),c[p](a)}return d}function e(){this[t]._s=[],this[t]._f=[],this[t]._d=[]}function f(a){b.f(k.onError)&&k.onError(a)}function g(a){function b(a){i[v]=a,i[q]=!0,i[s]=!1,c(function(){for(var a=0;a<i._s.length;a++)d(i._s[a],i[v],i._d[a]);e[u](g)})}function f(a){j(f,function(a){i[s]=!1,h[u](g,a)},b,g,a)}var g=this,i=g[t];i[q]||i[r]||i[s]||(i[s]=!0,f(a))}function h(a){function b(a){g[w]=a,g[r]=!0,g[s]=!1,c(function(){for(var a=0;a<g._f.length;a++)d(g._f[a],g[w],g._d[a]);e[u](f)})}var f=this,g=f[t];g[q]||g[r]||g[s]||(g[s]=!0,b(a))}function i(a,b){return function(e){c(function(){var c=d(a,e,b);j(b[o],b[p],b[o],b,c)})}}function j(a,c,d,e,g){var h,i;try{h=("object"==typeof g||b.f(g))&&g&&g.then}catch(a){return f(a),void c[u](e,a)}if(g===e[t])c[u](e,new TypeError(1));else if(b.f(h))try{h[u](g,function(b){i||(i=!0,a[u](e,b))},function(a){i||(i=!0,c[u](e,a))})}catch(a){if(i)return;i=!0,f(a),c[u](e,a)}else g===m?d[u](e):d[u](e,g)}function k(a){if(!(this instanceof k))return new k(a);var c=this;c[t]=a&&b.f(a.then)?a:new l(c),c[o]=function(a){g[u](c,a)},c[p]=function(a){h[u](c,a)}}function l(a){if(!(this instanceof l))return new l(a);if(this._s=[],this._f=[],this._d=[],this._defer=a&&a instanceof k?a:new k(this),this[q]=!1,this[r]=!1,this[s]=!1,this[v]=null,this[w]=null,b.f(a))try{a[u](this,this._defer[o],this._defer[p])}catch(a){f(a),this._defer[p](a)}}var m,n="prototype",o="resolve",p="reject",q="resolved",r="rejected",s="pending",t="promise",u="call",v="result",w="error";return l[n].then=function(a,c){var d,e,f=new k,g=this;return g._d.push(f),g[r]||(d=b.f(a)?i[u](g,a,f):f[o],g[q]?d[u](null,g[v]):g._s.push(d)),g[q]||(e=b.f(c)?i[u](g,c,f):f[p],g[r]?e[u](null,g[w]):g._f.push(e)),f[t]},k.Promise=l,k[o]=function(a){var b=new k;return b[o](a),b[t]},k[p]=function(a){var b=new k;return b[p](a),b[t]},a(k),k}(extAll,util,tickSmall)}(),Defer});